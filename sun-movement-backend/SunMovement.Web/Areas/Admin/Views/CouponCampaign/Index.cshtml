@using SunMovement.Core.Models
@{
    ViewData["Title"] = "Qu·∫£n l√Ω chi·∫øn d·ªãch email m√£ gi·∫£m gi√°";
    Layout = "_AdminLayout";
}

<div class="container-fluid px-4">
    <h1 class="mt-4">
        <i class="fas fa-envelope me-2"></i>Qu·∫£n l√Ω chi·∫øn d·ªãch email m√£ gi·∫£m gi√°
    </h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="AdminDashboard" asp-action="Index">Trang ch·ªß</a></li>
        <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="CouponsAdmin" asp-action="Index">M√£ gi·∫£m gi√°</a></li>
        <li class="breadcrumb-item active">Chi·∫øn d·ªãch email</li>
    </ol>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i> @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Campaign Overview Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                M√£ ch√†o m·ª´ng</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#welcomeCouponModal">
                                    <i class="fas fa-gift"></i> G·ª≠i m√£ ch√†o m·ª´ng
                                </button>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-plus fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Chi·∫øn d·ªãch theo m√πa</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#seasonalCampaignModal">
                                    <i class="fas fa-calendar-alt"></i> T·∫°o chi·∫øn d·ªãch
                                </button>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-snowflake fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Sinh nh·∫≠t kh√°ch h√†ng</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#birthdayCouponModal">
                                    <i class="fas fa-birthday-cake"></i> G·ª≠i m√£ sinh nh·∫≠t
                                </button>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-birthday-cake fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Kh√°ch h√†ng VIP</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#loyaltyCouponModal">
                                    <i class="fas fa-crown"></i> Tri √¢n VIP
                                </button>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-gem fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Campaign Options -->
    <div class="row mb-4">
        <div class="col-xl-6 col-md-6">
            <div class="card border-left-dark shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">
                                Gi·ªè h√†ng b·ªè l·ª°</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                <button type="button" class="btn btn-dark btn-sm" data-bs-toggle="modal" data-bs-target="#abandonedCartModal">
                                    <i class="fas fa-shopping-cart"></i> Nh·∫Øc nh·ªü gi·ªè h√†ng
                                </button>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-shopping-cart fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-6 col-md-6">
            <div class="card border-left-secondary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                                Chi·∫øn d·ªãch t√πy ch·ªânh</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#customCampaignModal">
                                    <i class="fas fa-bullhorn"></i> T·∫°o chi·∫øn d·ªãch custom
                                </button>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-bullhorn fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-tools me-1"></i>
            C√¥ng c·ª• h·ªó tr·ª£
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5>üß™ Test Email</h5>
                    <p>G·ª≠i email test ƒë·ªÉ ki·ªÉm tra c·∫•u h√¨nh email server</p>
                    <a asp-action="TestEmail" class="btn btn-outline-primary">
                        <i class="fas fa-paper-plane"></i> Test Email
                    </a>
                </div>
                <div class="col-md-6">
                    <h5>üìä Th·ªëng k√™ Campaign</h5>
                    <p>Xem b√°o c√°o hi·ªáu qu·∫£ c√°c chi·∫øn d·ªãch email ƒë√£ g·ª≠i</p>
                    <a asp-area="Admin" asp-controller="CouponsAdmin" asp-action="CouponStatistics" class="btn btn-outline-info">
                        <i class="fas fa-chart-bar"></i> Xem th·ªëng k√™
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Welcome Coupon -->
<div class="modal fade" id="welcomeCouponModal" tabindex="-1" aria-labelledby="welcomeCouponModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="SendWelcomeCoupon" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="welcomeCouponModalLabel">
                        <i class="fas fa-gift me-2"></i>G·ª≠i m√£ gi·∫£m gi√° ch√†o m·ª´ng
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="welcomeEmail" class="form-label">Email kh√°ch h√†ng</label>
                        <input type="email" class="form-control" id="welcomeEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="welcomeCustomerName" class="form-label">T√™n kh√°ch h√†ng</label>
                        <input type="text" class="form-control" id="welcomeCustomerName" name="customerName" required>
                    </div>
                    <div class="alert alert-info">
                        <h6>üìã Th√¥ng tin m√£ gi·∫£m gi√°:</h6>
                        <ul class="mb-0">
                            <li>Gi·∫£m 15% cho ƒë∆°n h√†ng ƒë·∫ßu ti√™n</li>
                            <li>ƒê∆°n h√†ng t·ªëi thi·ªÉu: 100,000 VNƒê</li>
                            <li>C√≥ hi·ªáu l·ª±c trong 30 ng√†y</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> G·ª≠i email
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Seasonal Campaign -->
<div class="modal fade" id="seasonalCampaignModal" tabindex="-1" aria-labelledby="seasonalCampaignModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form asp-action="SendSeasonalCampaign" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="seasonalCampaignModalLabel">
                        <i class="fas fa-calendar-alt me-2"></i>T·∫°o chi·∫øn d·ªãch theo m√πa
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="seasonalOccasion" class="form-label">D·ªãp ƒë·∫∑c bi·ªát</label>
                        <select class="form-select" id="seasonalOccasion" name="occasion" required>
                            <option value="">-- Ch·ªçn d·ªãp --</option>
                            <option value="T·∫øt Nguy√™n ƒê√°n">T·∫øt Nguy√™n ƒê√°n</option>
                            <option value="Qu·ªëc t·∫ø Ph·ª• n·ªØ">Qu·ªëc t·∫ø Ph·ª• n·ªØ 8/3</option>
                            <option value="Gi·ªó t·ªï H√πng V∆∞∆°ng">Gi·ªó t·ªï H√πng V∆∞∆°ng</option>
                            <option value="Qu·ªëc kh√°nh">Qu·ªëc kh√°nh 2/9</option>
                            <option value="Black Friday">Black Friday</option>
                            <option value="Noel">Noel</option>
                            <option value="M√πa h√®">M√πa h√®</option>
                            <option value="Khai tr∆∞·ªùng">Khai tr∆∞·ªùng</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="seasonalEmails" class="form-label">Danh s√°ch email kh√°ch h√†ng</label>
                        <textarea class="form-control" id="seasonalEmails" name="customerEmails" rows="5" 
                                  placeholder="Nh·∫≠p email kh√°ch h√†ng, m·ªói email m·ªôt d√≤ng ho·∫∑c c√°ch nhau b·∫±ng d·∫•u ph·∫©y" required></textarea>
                        <div class="form-text">H·ªó tr·ª£ ƒë·ªãnh d·∫°ng: email1@example.com, email2@example.com ho·∫∑c m·ªói email m·ªôt d√≤ng</div>
                    </div>
                    <div class="alert alert-success">
                        <h6>üéâ Th√¥ng tin chi·∫øn d·ªãch:</h6>
                        <ul class="mb-0">
                            <li>T·ª± ƒë·ªông t·∫°o m√£ gi·∫£m gi√° 20% theo d·ªãp</li>
                            <li>Th·ªùi gian hi·ªáu l·ª±c: 15 ng√†y</li>
                            <li>Template email chuy√™n nghi·ªáp b·∫±ng ti·∫øng Vi·ªát</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-rocket"></i> Kh·ªüi ch·∫°y chi·∫øn d·ªãch
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Birthday Coupon -->
<div class="modal fade" id="birthdayCouponModal" tabindex="-1" aria-labelledby="birthdayCouponModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="SendBirthdayCoupon" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="birthdayCouponModalLabel">
                        <i class="fas fa-birthday-cake me-2"></i>G·ª≠i m√£ gi·∫£m gi√° sinh nh·∫≠t
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="birthdayEmail" class="form-label">Email kh√°ch h√†ng</label>
                        <input type="email" class="form-control" id="birthdayEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="birthdayCustomerName" class="form-label">T√™n kh√°ch h√†ng</label>
                        <input type="text" class="form-control" id="birthdayCustomerName" name="customerName" required>
                    </div>
                    <div class="alert alert-warning">
                        <h6>üéÇ ƒê·∫∑c bi·ªát sinh nh·∫≠t:</h6>
                        <ul class="mb-0">
                            <li>Gi·∫£m 25% - ∆Øu ƒë√£i sinh nh·∫≠t ƒë·∫∑c bi·ªát</li>
                            <li>ƒê∆°n h√†ng t·ªëi thi·ªÉu: 200,000 VNƒê</li>
                            <li>C√≥ hi·ªáu l·ª±c trong 7 ng√†y</li>
                            <li>Ch·ªâ s·ª≠ d·ª•ng ƒë∆∞·ª£c 1 l·∫ßn</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-info">
                        <i class="fas fa-gift"></i> G·ª≠i qu√† sinh nh·∫≠t
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Loyalty Coupon -->
<div class="modal fade" id="loyaltyCouponModal" tabindex="-1" aria-labelledby="loyaltyCouponModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="SendLoyaltyCoupon" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="loyaltyCouponModalLabel">
                        <i class="fas fa-crown me-2"></i>Tri √¢n kh√°ch h√†ng VIP
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="loyaltyEmail" class="form-label">Email kh√°ch h√†ng VIP</label>
                        <input type="email" class="form-control" id="loyaltyEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="loyaltyCustomerName" class="form-label">T√™n kh√°ch h√†ng</label>
                        <input type="text" class="form-control" id="loyaltyCustomerName" name="customerName" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="loyaltyOrderCount" class="form-label">S·ªë ƒë∆°n h√†ng ƒë√£ mua</label>
                                <input type="number" class="form-control" id="loyaltyOrderCount" name="orderCount" min="1" max="1000" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="loyaltyTotalSpent" class="form-label">T·ªïng chi ti√™u (VNƒê)</label>
                                <input type="number" class="form-control" id="loyaltyTotalSpent" name="totalSpent" min="0" step="1000" required>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-dark">
                        <h6>üíé H·ªá th·ªëng tier VIP:</h6>
                        <ul class="mb-0 small">
                            <li><strong>Bronze (15%):</strong> < 5 ƒë∆°n h√†ng ho·∫∑c < 2M VNƒê</li>
                            <li><strong>Silver (20%):</strong> 5+ ƒë∆°n h√†ng ho·∫∑c 2M+ VNƒê</li>
                            <li><strong>Gold (25%):</strong> 10+ ƒë∆°n h√†ng ho·∫∑c 5M+ VNƒê</li>
                            <li><strong>VIP (30%):</strong> 20+ ƒë∆°n h√†ng ho·∫∑c 10M+ VNƒê</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-gem"></i> G·ª≠i ∆∞u ƒë√£i VIP
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Abandoned Cart -->
<div class="modal fade" id="abandonedCartModal" tabindex="-1" aria-labelledby="abandonedCartModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="SendAbandonedCartCoupon" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="abandonedCartModalLabel">
                        <i class="fas fa-shopping-cart me-2"></i>Nh·∫Øc nh·ªü gi·ªè h√†ng b·ªè l·ª°
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="cartEmail" class="form-label">Email kh√°ch h√†ng</label>
                        <input type="email" class="form-control" id="cartEmail" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="cartCustomerName" class="form-label">T√™n kh√°ch h√†ng</label>
                        <input type="text" class="form-control" id="cartCustomerName" name="customerName" required>
                    </div>
                    <div class="mb-3">
                        <label for="cartValue" class="form-label">Gi√° tr·ªã gi·ªè h√†ng (VNƒê)</label>
                        <input type="number" class="form-control" id="cartValue" name="cartValue" min="0" step="1000" required>
                        <div class="form-text">Gi√° tr·ªã hi·ªán t·∫°i c·ªßa gi·ªè h√†ng ch∆∞a thanh to√°n</div>
                    </div>
                    <div class="alert alert-info">
                        <h6>üõí C∆° ch·∫ø m√£ gi·∫£m gi√°:</h6>
                        <ul class="mb-0">
                            <li>Gi·∫£m 10% gi√° tr·ªã gi·ªè h√†ng (t·ªëi ƒëa 200,000 VNƒê)</li>
                            <li>ƒê∆°n h√†ng t·ªëi thi·ªÉu: 80% gi√° tr·ªã gi·ªè h√†ng ban ƒë·∫ßu</li>
                            <li>C√≥ hi·ªáu l·ª±c trong 48 gi·ªù (t·∫°o s·ª± kh·∫©n c·∫•p)</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-dark">
                        <i class="fas fa-bell"></i> G·ª≠i nh·∫Øc nh·ªü
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Custom Campaign -->
<div class="modal fade" id="customCampaignModal" tabindex="-1" aria-labelledby="customCampaignModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form asp-action="SendCustomCampaign" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="customCampaignModalLabel">
                        <i class="fas fa-bullhorn me-2"></i>T·∫°o chi·∫øn d·ªãch t√πy ch·ªânh
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="customCouponId" class="form-label">Ch·ªçn m√£ gi·∫£m gi√°</label>
                        <select class="form-select" id="customCouponId" name="couponId" required>
                            <option value="">-- Ch·ªçn m√£ gi·∫£m gi√° --</option>
                            @if (ViewBag.ActiveCoupons != null)
                            {
                                @foreach (var coupon in ViewBag.ActiveCoupons)
                                {
                                    <option value="@coupon.Id">@coupon.Code - @coupon.Name (@coupon.Value@(coupon.Type == CouponType.Percentage ? "%" : " VNƒê"))</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="customCampaignName" class="form-label">T√™n chi·∫øn d·ªãch</label>
                        <input type="text" class="form-control" id="customCampaignName" name="campaignName" 
                               placeholder="VD: Flash Sale cu·ªëi tu·∫ßn" required>
                    </div>
                    <div class="mb-3">
                        <label for="customCampaignDescription" class="form-label">M√¥ t·∫£ chi·∫øn d·ªãch</label>
                        <textarea class="form-control" id="customCampaignDescription" name="campaignDescription" rows="3"
                                  placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ chi·∫øn d·ªãch ƒë·ªÉ hi·ªÉn th·ªã trong email" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="customEmails" class="form-label">Danh s√°ch email kh√°ch h√†ng</label>
                        <textarea class="form-control" id="customEmails" name="customerEmails" rows="6" 
                                  placeholder="Nh·∫≠p email kh√°ch h√†ng, m·ªói email m·ªôt d√≤ng ho·∫∑c c√°ch nhau b·∫±ng d·∫•u ph·∫©y" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> G·ª≠i chi·∫øn d·ªãch
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Auto-format email lists
            $('textarea[name="customerEmails"]').on('blur', function() {
                var emails = $(this).val();
                if (emails) {
                    // Clean up email format
                    var cleanedEmails = emails
                        .split(/[,;\n\r]+/)
                        .map(email => email.trim())
                        .filter(email => email.length > 0)
                        .join('\n');
                    $(this).val(cleanedEmails);
                }
            });

            // Form validation enhancement
            $('form').on('submit', function(e) {
                var emailField = $(this).find('input[type="email"]');
                if (emailField.length > 0 && !emailField.val().includes('@@')) {
                    e.preventDefault();
                    alert('Vui l√≤ng nh·∫≠p email h·ª£p l·ªá');
                    emailField.focus();
                    return false;
                }

                var emailList = $(this).find('textarea[name="customerEmails"]');
                if (emailList.length > 0) {
                    var emails = emailList.val().split(/[,;\n\r]+/);
                    var validEmails = emails.filter(function(email) { 
                        return email.trim().includes('@@'); 
                    });
                    if (validEmails.length === 0) {
                        e.preventDefault();
                        alert('Vui l√≤ng nh·∫≠p √≠t nh·∫•t m·ªôt email h·ª£p l·ªá');
                        emailList.focus();
                        return false;
                    }
                }
            });
        });
    </script>
}
