@using Microsoft.AspNetCore.Identity
@using SunMovement.Core.Interfaces
@using SunMovement.Core.Models
@inject UserManager<ApplicationUser> UserManager
@inject IShoppingCartService ShoppingCartService

@{
    var user = await UserManager.GetUserAsync(User);
    var cartItemCount = 0;
    
    if (user != null)
    {
        var cart = await ShoppingCartService.GetCartWithItemsAsync(user.Id);
        if (cart != null)
        {
            cartItemCount = cart.Items.Sum(i => i.Quantity);
        }
    }
}

<a asp-controller="Cart" asp-action="Index" class="position-relative d-inline-block text-decoration-none">
    <i class="bi bi-cart3 fs-5"></i>
    @if (cartItemCount > 0)
    {
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            @(cartItemCount > 99 ? "99+" : cartItemCount.ToString())
            <span class="visually-hidden">items in cart</span>
        </span>
    }
</a>
